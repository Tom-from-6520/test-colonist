<!DOCTYPE html>
<html>
<style>
	html {
		width: 100%;
		height: 100%;
	}

	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
</style>
<head>
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas" width="800" height="400"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.

		app.resizeScreen = function(){
			var canvas = document.getElementById('canvas');
			canvas.width = window.innerWidth;
			canvas.height = window.innerHeight;
			app.width = canvas.width;
			app.height = canvas.height;

			this.nodes.length = 0;
			this.addPlayers();
		}

		app.addPlayers = function(){
			this.nodes.push({
				id : 'player1',
				x  : 100,
				y  : app.height/2,
				width  : 10,
				height : 126,
				color  : 'red'
			});

			this.nodes.push({
				id : 'player2',
				x  : (app.width-100),
				y  : app.height/2,
				width  : 10,
				height : 126,
				color  : 'blue'
			});

			var player1 = this.getNode('player1');
			var player2 = this.getNode('player2');

			window.addEventListener('keydown', (event) => {
				if(event.key === 'w' && player1.y > 0) {
					player1.y -= player1.height/8;
				}
				if(event.key === 's' && (player1.y + player1.height) < app.height) {
					player1.y += player1.height/8;
				}
				if(event.key === 'ArrowUp' && player2.y > 0) {
					player2.y -= player2.height/8;
				}
				if(event.key === 'ArrowDown' && (player2.y + player2.height) < app.height) {
					player2.y += player2.height/8;
				}
			});
		}

		app.addBall = function(){
			this.nodes.push({
				id : 'ball',
				x : app.width/2,
				y : app.height/2,
				width : 0,
				height : 0,
				radius : 8,
				color : 'black',
				vecX : 0,
				vecY : 0,
				potX : (Math.random()-0.5) * 6,
				potY : (Math.random()-0.5) * 3,
			});
			this.drawBall();

			var ball = this.getNode('ball');
			window.addEventListener('keydown', (event) => {
				if(event.key === ' ') {
					console.log(parseFloat(ball.vecX));
					this.pause(ball.vecX == 0);
				}
			});
		}

		app.pause = function(isPause) {
			var ball = this.getNode('ball');
			if(isPause) {
				ball.vecX = ball.potX;
				ball.vecY = ball.potY;
				ball.potX = 0;
				ball.potY = 0;
			}
			else {
				ball.potX = ball.vecX;
				ball.potY = ball.vecY;
				ball.vecX = 0;
				ball.vecY = 0;
			}
		}

		app.drawBall = function(){
			var ctx = document.getElementById('canvas').getContext('2d');
			var ball = this.getNode('ball');
			ctx.beginPath();
			ctx.arc(ball.x,ball.y,ball.radius,0,Math.PI*2);
			ctx.fillStyle = ball.color;
			ctx.fill();
			ctx.strokeStyle = '#ffffff';
			ctx.stroke();
		}

		app.deleteNode = function(id) {
			for(var i = 0; i < this.nodes.length; i++) {
				if(app.nodes[i].id === id) {
					app.nodes.splice(i);
					break;
				}
			}
		}

		app.hasNode = function(id){
			return (app.getNode(id).x != null);
		}

		app.onInit = function(){
			this.resizeScreen();

			window.addEventListener('resize', () => {
				this.resizeScreen();
			});

			window.addEventListener('keydown', (event) => {
				if(!this.hasNode('ball') && event.key === ' ') {
					this.addBall();
				}
			});
		};

		app.onUpdate = function(time){
			var ball = this.getNode('ball');
			var player1 = this.getNode('player1');
			var player2 = this.getNode('player2');

			if ((ball.y - ball.radius) < 0 || (ball.y + ball.radius) > app.height) {
				ball.vecY = - ball.vecY;
			}
			else if ( ((ball.x - ball.radius) <= (player1.x + player1.width) && ball.y >= player1.y && ball.y <= (player1.y + player1.height)) 
					|| ((ball.x + ball.radius) >= player2.x && ball.y >= player2.y && ball.y <= (player2.y + player2.height)) ) {
				ball.vecX = - ball.vecX;
			}
			ball.x += ball.vecX;
			ball.y += ball.vecY;
			this.drawBall();
		};
	</script>
</body>
</html>